import { __awaiter } from "tslib";
import { Classe } from "../Classes/Classe";
import { TFile } from "obsidian";
import { FileProperty } from "../Utils/Properties/FileProperty";
describe("Classe Tests", () => {
    let mockApp;
    let mockVault;
    let mockFile;
    let instance;
    beforeEach(() => {
        mockApp = {
            vault: {
                getAbstractFileByPath: jest.fn()
            },
            metadataCache: {
                getFileCache: jest.fn(),
            }
        };
        mockVault = {
            getFromFile: jest.fn()
        };
        mockFile = {
            path: "folder/mockFile.md",
            name: "mockFile.md"
        };
        instance = new Classe(mockApp, mockVault, mockFile);
    });
    // Fonction utilitaire pour configurer les mocks
    const setupMocks = ({ folderPath = "", fileName = "", parentPath = "", parentFileFound = true, parentName = "parentProp" }) => {
        const mockParentFile = parentFileFound ? new TFile() : null;
        if (mockParentFile) {
            mockParentFile.path = parentPath;
        }
        // Mocker les retours des méthodes nécessaires
        mockApp.vault.getAbstractFileByPath = jest.fn().mockReturnValue(mockParentFile);
        mockVault.getFromFile = jest.fn().mockReturnValue({
            getLink: jest.fn().mockReturnValue("parentLink")
        });
        instance.getparentProperties = jest.fn().mockReturnValue({
            name: parentName
        });
    };
    test("should update metadata when parent file is found", () => __awaiter(void 0, void 0, void 0, function* () {
        // Arrange
        setupMocks({
            folderPath: "/folder/parent",
            fileName: "child.md",
            parentPath: "/folder/parent/parent.md"
        });
        instance.updateMetadata = jest.fn();
        // Exécution de la méthode
        yield instance.updatePropertyParent();
        // Vérifications
        expect(mockApp.vault.getAbstractFileByPath).toHaveBeenCalledWith("folder/folder.md");
        expect(instance.updateMetadata).toHaveBeenCalledWith("parentProp", "parentLink");
    }));
    test("should update metadata when in the folder of the file", () => __awaiter(void 0, void 0, void 0, function* () {
        // Arrange
        setupMocks({
            folderPath: "/folder/parent",
            fileName: "parent.md",
            parentPath: "/folder/parent/parent.md"
        });
        instance.updateMetadata = jest.fn();
        // Exécution de la méthode
        yield instance.updatePropertyParent();
        // Vérifications
        expect(mockApp.vault.getAbstractFileByPath).toHaveBeenCalledWith("folder/folder.md");
        expect(instance.updateMetadata).toHaveBeenCalledWith("parentProp", "parentLink");
    }));
    test("should not update metadata if parent file is not found", () => __awaiter(void 0, void 0, void 0, function* () {
        // Arrange
        setupMocks({
            folderPath: "/folder/parent",
            fileName: "child.md",
            parentPath: "/folder/parent/parent.md",
            parentFileFound: false
        });
        instance.updateMetadata = jest.fn();
        // Exécution de la méthode
        yield instance.updatePropertyParent();
        // Vérifications
        expect(mockApp.vault.getAbstractFileByPath).toHaveBeenCalledWith("folder/folder.md");
        expect(instance.updateMetadata).not.toHaveBeenCalled(); // Le fichier ne devrait pas être mis à jour
    }));
    test("should handle parent folder with multiple subfolders correctly", () => __awaiter(void 0, void 0, void 0, function* () {
        // Arrange
        setupMocks({
            folderPath: "/folder/parent/subfolder",
            fileName: "child.md",
            parentPath: "/folder/parent/subfolder/parent.md"
        });
        instance.updateMetadata = jest.fn();
        // Exécution de la méthode
        yield instance.updatePropertyParent();
        // Vérifications
        expect(mockApp.vault.getAbstractFileByPath).toHaveBeenCalledWith("folder/folder.md");
        expect(instance.updateMetadata).toHaveBeenCalledWith("parentProp", "parentLink");
    }));
    test("should update metadata when folder is correctly adjusted", () => __awaiter(void 0, void 0, void 0, function* () {
        // Arrange
        setupMocks({
            folderPath: "/folder/parent",
            fileName: "child.md",
            parentPath: "/folder/parent/parent.md"
        });
        instance.updateMetadata = jest.fn();
        // Exécution de la méthode
        yield instance.updatePropertyParent();
        // Vérifications
        expect(mockApp.vault.getAbstractFileByPath).toHaveBeenCalledWith("folder/folder.md");
        expect(instance.updateMetadata).toHaveBeenCalledWith("parentProp", "parentLink");
    }));
    test("Classe should be initialized correctly", () => {
        expect(instance.app).toBe(mockApp);
        expect(instance.vault).toBe(mockVault);
        expect(instance.file).toBe(mockFile);
    });
    test("getClasse() should throw an error", () => {
        expect(() => instance.getClasse()).toThrow("Need to define the subClasses");
    });
    test("static getClasse() should return className", () => {
        Classe.className = "TestClass";
        expect(Classe.getClasse()).toBe("TestClass");
    });
    test("getProperties() should return Classe.Properties", () => {
        expect(Classe.getProperties()).toEqual({});
    });
    test("addChild() should create folders and move child correctly", () => __awaiter(void 0, void 0, void 0, function* () {
        const childInstance = new Classe(mockApp, mockVault, mockFile);
        mockApp.vault.getAbstractFileByPath = jest.fn().mockReturnValue(null);
        mockApp.vault.createFolder = jest.fn();
        instance.move = jest.fn();
        expect(mockApp.vault.createFolder).toHaveBeenCalled();
        expect(instance.move).toHaveBeenCalled();
    }));
    test("update() should call updateLocation()", () => __awaiter(void 0, void 0, void 0, function* () {
        instance.getparentProperties = jest.fn().mockReturnValue(new FileProperty("test", Classe));
        instance.updateLocation = jest.fn();
        yield instance.update();
        expect(instance.updateLocation).toHaveBeenCalled();
    }));
    test("updateLocation() should correctly check and move file", () => __awaiter(void 0, void 0, void 0, function* () {
        const mockProperty = {
            getLink: jest.fn().mockReturnValue({
                getClasse: jest.fn().mockReturnValue("TestClass"),
                getChildFolderPath: jest.fn().mockReturnValue("childPath"),
                addChild: jest.fn()
            }),
            getClasse: jest.fn().mockReturnValue("TestClass")
        };
        instance.getFolderPath = jest.fn().mockReturnValue("currentPath");
        expect(mockProperty.getLink).toHaveBeenCalled();
    }));
    test("check() should be callable", () => __awaiter(void 0, void 0, void 0, function* () {
        yield expect(instance.check()).resolves.toBeUndefined();
    }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2xhc3Nlcy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ2xhc3Nlcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDM0MsT0FBTyxFQUFFLEtBQUssRUFBTyxNQUFNLFVBQVUsQ0FBQztBQUV0QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFJaEUsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxPQUFZLENBQUM7SUFDakIsSUFBSSxTQUFrQixDQUFDO0lBQ3ZCLElBQUksUUFBZSxDQUFDO0lBQ3BCLElBQUksUUFBZ0IsQ0FBQztJQUVyQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osT0FBTyxHQUFHO1lBQ04sS0FBSyxFQUFFO2dCQUNILHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDbkM7WUFDRCxhQUFhLEVBQUU7Z0JBQ1gsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDMUI7U0FDYyxDQUFDO1FBRXBCLFNBQVMsR0FBRztZQUNSLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ0gsQ0FBQztRQUV4QixRQUFRLEdBQUc7WUFDUCxJQUFJLEVBQUUsb0JBQW9CO1lBQzFCLElBQUksRUFBRSxhQUFhO1NBQ0YsQ0FBQztRQUV0QixRQUFRLEdBQUcsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4RCxDQUFDLENBQUMsQ0FBQztJQUVGLGdEQUFnRDtJQUNuRCxNQUFNLFVBQVUsR0FBRyxDQUFDLEVBQ2xCLFVBQVUsR0FBRyxFQUFFLEVBQ2YsUUFBUSxHQUFHLEVBQUUsRUFDYixVQUFVLEdBQUcsRUFBRSxFQUNmLGVBQWUsR0FBRyxJQUFJLEVBQ3RCLFVBQVUsR0FBRyxZQUFZLEVBQzFCLEVBQUUsRUFBRTtRQUNI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QUFDO1lBQ0YsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDO1NBQ3pCLENBQUM7UUFFN0IsUUFBUSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBR2xFLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUNwRCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEdBQVMsRUFBRTtRQUMxQyxNQUFNLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xhc3NlIH0gZnJvbSBcIi4uL0NsYXNzZXMvQ2xhc3NlXCI7XHJcbmltcG9ydCB7IFRGaWxlLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgTXlWYXVsdCB9IGZyb20gXCIuLi9VdGlscy9NeVZhdWx0XCI7XHJcbmltcG9ydCB7IEZpbGVQcm9wZXJ0eSB9IGZyb20gXCIuLi9VdGlscy9Qcm9wZXJ0aWVzL0ZpbGVQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBGaWxlIH0gZnJvbSBcIi4uL1V0aWxzL0ZpbGVcIjtcclxuXHJcblxyXG5kZXNjcmliZShcIkNsYXNzZSBUZXN0c1wiLCAoKSA9PiB7XHJcbiAgICBsZXQgbW9ja0FwcDogQXBwO1xyXG4gICAgbGV0IG1vY2tWYXVsdDogTXlWYXVsdDtcclxuICAgIGxldCBtb2NrRmlsZTogVEZpbGU7XHJcbiAgICBsZXQgaW5zdGFuY2U6IENsYXNzZTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBtb2NrQXBwID0ge1xyXG4gICAgICAgICAgICB2YXVsdDoge1xyXG4gICAgICAgICAgICAgICAgZ2V0QWJzdHJhY3RGaWxlQnlQYXRoOiBqZXN0LmZuKClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWV0YWRhdGFDYWNoZToge1xyXG4gICAgICAgICAgICAgICAgZ2V0RmlsZUNhY2hlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIHVua25vd24gYXMgQXBwO1xyXG5cclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGdldEZyb21GaWxlOiBqZXN0LmZuKClcclxuICAgICAgICB9IGFzIHVua25vd24gYXMgTXlWYXVsdDtcclxuXHJcbiAgICAgICAgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgICAgIHBhdGg6IFwiZm9sZGVyL21vY2tGaWxlLm1kXCIsXHJcbiAgICAgICAgICAgIG5hbWU6IFwibW9ja0ZpbGUubWRcIlxyXG4gICAgICAgIH0gYXMgdW5rbm93biBhcyBURmlsZTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2UgPSBuZXcgQ2xhc3NlKG1vY2tBcHAsIG1vY2tWYXVsdCwgbW9ja0ZpbGUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgIC8vIEZvbmN0aW9uIHV0aWxpdGFpcmUgcG91ciBjb25maWd1cmVyIGxlcyBtb2Nrc1xyXG4gIGNvbnN0IHNldHVwTW9ja3MgPSAoe1xyXG4gICAgZm9sZGVyUGF0aCA9IFwiXCIsXHJcbiAgICBmaWxlTmFtZSA9IFwiXCIsXHJcbiAgICBwYXJlbnRQYXRoID0gXCJcIixcclxuICAgIHBhcmVudEZpbGVGb3VuZCA9IHRydWUsXHJcbiAgICBwYXJlbnROYW1lID0gXCJwYXJlbnRQcm9wXCJcclxuICB9KSA9PiB7XHJcbiAgICBjb25zdCBtb2NrUGFyZW50RmlsZSA9IHBhcmVudEZpbGVGb3VuZCA/IG5ldyBURmlsZSgpIDogbnVsbDtcclxuICAgIGlmIChtb2NrUGFyZW50RmlsZSkge1xyXG4gICAgICBtb2NrUGFyZW50RmlsZS5wYXRoID0gcGFyZW50UGF0aDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNb2NrZXIgbGVzIHJldG91cnMgZGVzIG3DqXRob2RlcyBuw6ljZXNzYWlyZXNcclxuICAgIG1vY2tBcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrUGFyZW50RmlsZSk7XHJcbiAgICBtb2NrVmF1bHQuZ2V0RnJvbUZpbGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgZ2V0TGluazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcInBhcmVudExpbmtcIilcclxuICAgIH0pO1xyXG5cclxuICAgIGluc3RhbmNlLmdldHBhcmVudFByb3BlcnRpZXMgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgbmFtZTogcGFyZW50TmFtZVxyXG4gICAgfSBhcyBGaWxlUHJvcGVydHkpO1xyXG4gIH07XHJcbiAgdGVzdChcInNob3VsZCB1cGRhdGUgbWV0YWRhdGEgd2hlbiBwYXJlbnQgZmlsZSBpcyBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlXHJcbiAgICBzZXR1cE1vY2tzKHtcclxuICAgICAgZm9sZGVyUGF0aDogXCIvZm9sZGVyL3BhcmVudFwiLFxyXG4gICAgICBmaWxlTmFtZTogXCJjaGlsZC5tZFwiLFxyXG4gICAgICBwYXJlbnRQYXRoOiBcIi9mb2xkZXIvcGFyZW50L3BhcmVudC5tZFwiXHJcbiAgICB9KTtcclxuICAgIGluc3RhbmNlLnVwZGF0ZU1ldGFkYXRhID0gamVzdC5mbigpO1xyXG5cclxuICAgIC8vIEV4w6ljdXRpb24gZGUgbGEgbcOpdGhvZGVcclxuICAgIGF3YWl0IGluc3RhbmNlLnVwZGF0ZVByb3BlcnR5UGFyZW50KCk7XHJcblxyXG4gICAgLy8gVsOpcmlmaWNhdGlvbnNcclxuICAgIGV4cGVjdChtb2NrQXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJmb2xkZXIvZm9sZGVyLm1kXCIpO1xyXG4gICAgZXhwZWN0KGluc3RhbmNlLnVwZGF0ZU1ldGFkYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcInBhcmVudFByb3BcIiwgXCJwYXJlbnRMaW5rXCIpO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwic2hvdWxkIHVwZGF0ZSBtZXRhZGF0YSB3aGVuIGluIHRoZSBmb2xkZXIgb2YgdGhlIGZpbGVcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZVxyXG4gICAgc2V0dXBNb2Nrcyh7XHJcbiAgICAgIGZvbGRlclBhdGg6IFwiL2ZvbGRlci9wYXJlbnRcIixcclxuICAgICAgZmlsZU5hbWU6IFwicGFyZW50Lm1kXCIsXHJcbiAgICAgIHBhcmVudFBhdGg6IFwiL2ZvbGRlci9wYXJlbnQvcGFyZW50Lm1kXCJcclxuICAgIH0pO1xyXG5cclxuICAgIGluc3RhbmNlLnVwZGF0ZU1ldGFkYXRhID0gamVzdC5mbigpO1xyXG4gICAgLy8gRXjDqWN1dGlvbiBkZSBsYSBtw6l0aG9kZVxyXG4gICAgYXdhaXQgaW5zdGFuY2UudXBkYXRlUHJvcGVydHlQYXJlbnQoKTtcclxuXHJcbiAgICAvLyBWw6lyaWZpY2F0aW9uc1xyXG4gICAgZXhwZWN0KG1vY2tBcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImZvbGRlci9mb2xkZXIubWRcIik7XHJcbiAgICBleHBlY3QoaW5zdGFuY2UudXBkYXRlTWV0YWRhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwicGFyZW50UHJvcFwiLCBcInBhcmVudExpbmtcIik7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoXCJzaG91bGQgbm90IHVwZGF0ZSBtZXRhZGF0YSBpZiBwYXJlbnQgZmlsZSBpcyBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZVxyXG4gICAgc2V0dXBNb2Nrcyh7XHJcbiAgICAgIGZvbGRlclBhdGg6IFwiL2ZvbGRlci9wYXJlbnRcIixcclxuICAgICAgZmlsZU5hbWU6IFwiY2hpbGQubWRcIixcclxuICAgICAgcGFyZW50UGF0aDogXCIvZm9sZGVyL3BhcmVudC9wYXJlbnQubWRcIixcclxuICAgICAgcGFyZW50RmlsZUZvdW5kOiBmYWxzZVxyXG4gICAgfSk7XHJcblxyXG4gICAgaW5zdGFuY2UudXBkYXRlTWV0YWRhdGEgPSBqZXN0LmZuKCk7XHJcbiAgICAvLyBFeMOpY3V0aW9uIGRlIGxhIG3DqXRob2RlXHJcbiAgICBhd2FpdCBpbnN0YW5jZS51cGRhdGVQcm9wZXJ0eVBhcmVudCgpO1xyXG5cclxuICAgIC8vIFbDqXJpZmljYXRpb25zXHJcbiAgICBleHBlY3QobW9ja0FwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwiZm9sZGVyL2ZvbGRlci5tZFwiKTtcclxuICAgIGV4cGVjdChpbnN0YW5jZS51cGRhdGVNZXRhZGF0YSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsgLy8gTGUgZmljaGllciBuZSBkZXZyYWl0IHBhcyDDqnRyZSBtaXMgw6Agam91clxyXG4gIH0pO1xyXG5cclxuICB0ZXN0KFwic2hvdWxkIGhhbmRsZSBwYXJlbnQgZm9sZGVyIHdpdGggbXVsdGlwbGUgc3ViZm9sZGVycyBjb3JyZWN0bHlcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gQXJyYW5nZVxyXG4gICAgc2V0dXBNb2Nrcyh7XHJcbiAgICAgIGZvbGRlclBhdGg6IFwiL2ZvbGRlci9wYXJlbnQvc3ViZm9sZGVyXCIsXHJcbiAgICAgIGZpbGVOYW1lOiBcImNoaWxkLm1kXCIsXHJcbiAgICAgIHBhcmVudFBhdGg6IFwiL2ZvbGRlci9wYXJlbnQvc3ViZm9sZGVyL3BhcmVudC5tZFwiXHJcbiAgICB9KTtcclxuICAgIGluc3RhbmNlLnVwZGF0ZU1ldGFkYXRhID0gamVzdC5mbigpO1xyXG4gICAgLy8gRXjDqWN1dGlvbiBkZSBsYSBtw6l0aG9kZVxyXG4gICAgYXdhaXQgaW5zdGFuY2UudXBkYXRlUHJvcGVydHlQYXJlbnQoKTtcclxuXHJcbiAgICAvLyBWw6lyaWZpY2F0aW9uc1xyXG4gICAgZXhwZWN0KG1vY2tBcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImZvbGRlci9mb2xkZXIubWRcIik7XHJcbiAgICBleHBlY3QoaW5zdGFuY2UudXBkYXRlTWV0YWRhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwicGFyZW50UHJvcFwiLCBcInBhcmVudExpbmtcIik7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoXCJzaG91bGQgdXBkYXRlIG1ldGFkYXRhIHdoZW4gZm9sZGVyIGlzIGNvcnJlY3RseSBhZGp1c3RlZFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBBcnJhbmdlXHJcbiAgICBzZXR1cE1vY2tzKHtcclxuICAgICAgZm9sZGVyUGF0aDogXCIvZm9sZGVyL3BhcmVudFwiLFxyXG4gICAgICBmaWxlTmFtZTogXCJjaGlsZC5tZFwiLFxyXG4gICAgICBwYXJlbnRQYXRoOiBcIi9mb2xkZXIvcGFyZW50L3BhcmVudC5tZFwiXHJcbiAgICB9KTtcclxuICAgIGluc3RhbmNlLnVwZGF0ZU1ldGFkYXRhID0gamVzdC5mbigpO1xyXG4gICAgLy8gRXjDqWN1dGlvbiBkZSBsYSBtw6l0aG9kZVxyXG4gICAgYXdhaXQgaW5zdGFuY2UudXBkYXRlUHJvcGVydHlQYXJlbnQoKTtcclxuXHJcbiAgICAvLyBWw6lyaWZpY2F0aW9uc1xyXG4gICAgZXhwZWN0KG1vY2tBcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImZvbGRlci9mb2xkZXIubWRcIik7XHJcbiAgICBleHBlY3QoaW5zdGFuY2UudXBkYXRlTWV0YWRhdGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwicGFyZW50UHJvcFwiLCBcInBhcmVudExpbmtcIik7XHJcbiAgfSk7XHJcblxyXG4gICAgdGVzdChcIkNsYXNzZSBzaG91bGQgYmUgaW5pdGlhbGl6ZWQgY29ycmVjdGx5XCIsICgpID0+IHtcclxuICAgICAgICBleHBlY3QoaW5zdGFuY2UuYXBwKS50b0JlKG1vY2tBcHApO1xyXG4gICAgICAgIGV4cGVjdChpbnN0YW5jZS52YXVsdCkudG9CZShtb2NrVmF1bHQpO1xyXG4gICAgICAgIGV4cGVjdChpbnN0YW5jZS5maWxlKS50b0JlKG1vY2tGaWxlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJnZXRDbGFzc2UoKSBzaG91bGQgdGhyb3cgYW4gZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdCgoKSA9PiBpbnN0YW5jZS5nZXRDbGFzc2UoKSkudG9UaHJvdyhcIk5lZWQgdG8gZGVmaW5lIHRoZSBzdWJDbGFzc2VzXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInN0YXRpYyBnZXRDbGFzc2UoKSBzaG91bGQgcmV0dXJuIGNsYXNzTmFtZVwiLCAoKSA9PiB7XHJcbiAgICAgICAgQ2xhc3NlLmNsYXNzTmFtZSA9IFwiVGVzdENsYXNzXCI7XHJcbiAgICAgICAgZXhwZWN0KENsYXNzZS5nZXRDbGFzc2UoKSkudG9CZShcIlRlc3RDbGFzc1wiKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICB0ZXN0KFwiZ2V0UHJvcGVydGllcygpIHNob3VsZCByZXR1cm4gQ2xhc3NlLlByb3BlcnRpZXNcIiwgKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChDbGFzc2UuZ2V0UHJvcGVydGllcygpKS50b0VxdWFsKHt9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJhZGRDaGlsZCgpIHNob3VsZCBjcmVhdGUgZm9sZGVycyBhbmQgbW92ZSBjaGlsZCBjb3JyZWN0bHlcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkSW5zdGFuY2UgPSBuZXcgQ2xhc3NlKG1vY2tBcHAsIG1vY2tWYXVsdCwgbW9ja0ZpbGUpO1xyXG5cclxuICAgICAgICBtb2NrQXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgbW9ja0FwcC52YXVsdC5jcmVhdGVGb2xkZXIgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgaW5zdGFuY2UubW92ZSA9IGplc3QuZm4oKTtcclxuXHJcblxyXG4gICAgICAgIGV4cGVjdChtb2NrQXBwLnZhdWx0LmNyZWF0ZUZvbGRlcikudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIGV4cGVjdChpbnN0YW5jZS5tb3ZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KFwidXBkYXRlKCkgc2hvdWxkIGNhbGwgdXBkYXRlTG9jYXRpb24oKVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgaW5zdGFuY2UuZ2V0cGFyZW50UHJvcGVydGllcyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobmV3IEZpbGVQcm9wZXJ0eShcInRlc3RcIiwgQ2xhc3NlKSk7XHJcbiAgICAgICAgaW5zdGFuY2UudXBkYXRlTG9jYXRpb24gPSBqZXN0LmZuKCk7XHJcblxyXG4gICAgICAgIGF3YWl0IGluc3RhbmNlLnVwZGF0ZSgpO1xyXG5cclxuICAgICAgICBleHBlY3QoaW5zdGFuY2UudXBkYXRlTG9jYXRpb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJ1cGRhdGVMb2NhdGlvbigpIHNob3VsZCBjb3JyZWN0bHkgY2hlY2sgYW5kIG1vdmUgZmlsZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW9ja1Byb3BlcnR5ID0ge1xyXG4gICAgICAgICAgICBnZXRMaW5rOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGdldENsYXNzZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcIlRlc3RDbGFzc1wiKSxcclxuICAgICAgICAgICAgICAgIGdldENoaWxkRm9sZGVyUGF0aDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcImNoaWxkUGF0aFwiKSxcclxuICAgICAgICAgICAgICAgIGFkZENoaWxkOiBqZXN0LmZuKClcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIGdldENsYXNzZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcIlRlc3RDbGFzc1wiKVxyXG4gICAgICAgIH0gYXMgdW5rbm93biBhcyBGaWxlUHJvcGVydHk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLmdldEZvbGRlclBhdGggPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFwiY3VycmVudFBhdGhcIik7XHJcblxyXG5cclxuICAgICAgICBleHBlY3QobW9ja1Byb3BlcnR5LmdldExpbmspLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJjaGVjaygpIHNob3VsZCBiZSBjYWxsYWJsZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgZXhwZWN0KGluc3RhbmNlLmNoZWNrKCkpLnJlc29sdmVzLnRvQmVVbmRlZmluZWQoKTtcclxuICAgIH0pO1xyXG59KTtcclxuIl19